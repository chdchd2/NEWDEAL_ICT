<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.FestivalMapper">

<resultMap type="com.newdeal.ict.Vo.FesDetailVo" id="fesDevo">
	<result property="fesNum" column="fesNum"/>
	<result property="memNum" column="memNum"/>
	<result property="fesTitle" column="fesTitle"/>
	<result property="fesContent" column="fesContent"/>
	<result property="fesWriter" column="fesWriter"/>
	<result property="fesDate" column="fesDate"/>
	<result property="fesHit" column="fesHit"/>
	<collection property="list" ofType="com.newdeal.ict.Vo.CommonFileVo">
		<result property="fileNum" column="fileNum"/>
		<result property="fileName" column="fileName"/>
		<result property="fileOrgName" column="fileOrgName"/>
		<result property="fileSize" column="fileSize"/>
		<result property="filePath" column="filePath"/>
		<result property="fileRefBoard" column="fileRefBoard"/>
		<result property="fileRefNum" column="fileRefNum"/>
	</collection>
</resultMap>

<insert parameterType="fesvo" id="fesWrite"> 
	insert into FESTIVAL VALUES( 
		SEQ_FESTIVAL_FES_NUM.nextval,
		#{fesTitle},
		#{fesContent},
		sysdate,
		#{fesWrite},
		0,
		null 
		)
</insert>


<select id="list" parameterType="pagevo" resultType="fesvo">
      SELECT FES_NUM AS fesNum,
      		 FES_TITLE AS fesTitle,
      		 FES_CONTENT AS fesContent,
      		 FES_DATE AS fesDate,
      		 FES_WRITE AS fesWrite,
      		 FES_HIT AS fesHit,
      		 MEM_NUM AS MEMNUM,
      		 RNUM RNUM
       FROM(
                    SELECT AA.*,ROWNUM RNUM FROM(
                                 SELECT * FROM FESTIVAL
                                 ORDER BY FES_NUM DESC
                                				 )AA
                     )
      <![CDATA[where rnum >=#{startRow} and rnum <=#{endRow}]]>
	
</select>

<select id="fesCnt" resultType="int">
 			SELECT NVL(COUNT(*),0) CNT from FESTIVAL <!--  글이 하나도 없는경우는 result값이 null이나오기때문에 NVL로 널인경우에는 0으로 넣어주어라(resulttype이 int여서)-->			
</select>

 <select id="fesmaxNum" resultType="int">
	SELECT NVL(MAX(FES_NUM),1) AS MAXNUM 
	FROM FESTIVAL
</select> 


<select id="fesDetail" parameterType="int" resultMap="fesDevo">
	SELECT  FES_NUM AS fesNum,
      		 FES_TITLE AS fesTitle,
      		 FES_CONTENT AS fesContent,
      		 FES_DATE AS fesDate,
      		 FES_WRITE AS fesWrite,
      		 FES_HIT AS fesHit,
      		 MEM_NUM AS MEM_NUM,
			FILE_NUM AS FILENUM,
			FILE_NAME AS FILENAME,
			FILE_ORGNAME AS FILEORGNAME,
			FILE_SIZE AS FILESIZE,
			FILE_PATH AS FILEPATH,
			FILE_REF_BOARD AS FILEREFBOARD,
			FILE_REF_NUM AS FILEREFNUM FROM 
		FESTIVAL A,COMMON_FILE B 
	WHERE A.FES_NUM=B.FILE_REF_NUM(+)
	AND A.FES_NUM=#{fesNum}
</select>

<select id="fileinfo" parameterType="int" resultType="filevo">
	SELECT  FILE_NUM AS FILENUM,
			FILE_NAME AS FILENAME,
			FILE_ORGNAME AS FILEORGNAME,
			FILE_SIZE AS FILESIZE,
			FILE_PATH AS FILEPATH,
			FILE_REF_BOARD AS FILEREFBOARD,
			FILE_REF_NUM AS FILEREFNUM
	FROM 
			COMMON_FILE
	WHERE
			FILE_NUM=#{fileNum}
</select>


<select id="getWriter" parameterType="int" resultType="fesvo">
	SELECT  FES_NUM AS fesNum,
      		 FES_TITLE AS fesTitle,
      		 FES_CONTENT AS fesContent,
      		 FES_DATE AS fesDate,
      		 FES_WRITE AS fesWrite,
      		 FES_HIT AS fesHit,
      		 MEM_NUM AS MEMNUM
	FROM	FESTIVAL
	WHERE FES_NUM=#{fesNum}
</select>

<update id="detailCntUp" parameterType="int">
	UPDATE FESTIVAL SET FES_HIT=FES_HIT+1 WHERE FES_NUM=#{fesNum}
</update>


<delete id="fesDelete" parameterType="int">
	DELETE FESTIVAL WHERE FES_NUM=#{fesNum}
</delete>

<delete id="intFileDelete" parameterType="int">
	DELETE COMMON_FILE WHERE FILE_REF_BOARD='FESTIVAL' AND FILE_REF_NUM=#{fesNum}
</delete>

<select id="intFileDelList" parameterType="int" resultType="filevo">
	SELECT  FILE_NUM AS FILENUM,
			FILE_NAME AS FILENAME,
			FILE_ORGNAME AS FILEORGNAME,
			FILE_SIZE AS FILESIZE,
			FILE_PATH AS FILEPATH,
			FILE_REF_BOARD AS FILEREFBOARD,
			FILE_REF_NUM AS FILEREFNUM 
	 FROM COMMON_FILE 
	 WHERE FILE_REF_BOARD='FESTIVAL' AND FILE_REF_NUM=#{fesNum}
</select>

<update id="fesEdit" parameterType="fesvo">
	UPDATE FESTIVAL SET FES_TITLE=#{fesTitle},FES_CONTENT=#{fesContent} WHERE FES_NUM=#{fesNum}
</update>

<delete id="fileDel" parameterType="filevo">
	DELETE COMMON_FILE WHERE FILE_NUM=#{fileNum}
</delete>

</mapper>

 